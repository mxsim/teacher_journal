{{!-- subject_profile.hbs --}}
<div class="profile-container">
  <div class="profile">
<div class="subject-header {{#if subject.subject_photo}}with-image{{else}}no-image{{/if}}">
  <h1 class="subject-name">{{subject.subject_name}}</h1>
  <div class="teacher-info">
    <img src="{{teacher.image}}" class="teacher-photo" alt="Teacher photo">
    <div>
      <p>–í–∏–∫–ª–∞–¥–∞—á: {{teacher.name}} {{teacher.surname}}</p>
      <p>–ö–∞—Ñ–µ–¥—Ä–∞: {{subject.department_name}}</p>
    </div>
  </div>
    {{#if subject.subject_photo}}
    <img src="{{subject.subject_photo}}" alt="Subject Icon" class="subject-photo">
    {{else}}
      <p>No subject photo available</p>
    {{/if}}
</div>

    <!-- Description Section -->
    {{#if isOwner}}
    <div class="description-editor">
      <form id="descriptionForm"
            action="/subject/{{subject.subject_id}}/description"
            method="POST">
        <textarea id="subjectDescription"
                  name="description"
                  placeholder="–î–æ–¥–∞–π—Ç–µ –æ–ø–∏—Å –ø—Ä–µ–¥–º–µ—Ç—É...">{{subject.description}}</textarea>
        <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏ –æ–ø–∏—Å</button>
        <div id="descriptionMessage" class="message"></div>
      </form>
    </div>
    {{else}}
    <div class="subject-description">
      {{#if subject.description}}
        {{{subject.description}}}
      {{else}}
        <em>–û–ø–∏—Å –ø—Ä–µ–¥–º–µ—Ç—É –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</em>
      {{/if}}
    </div>
    {{/if}}

    <!-- Tabs -->
    <div class="nav-buttons">
      <button class="nav-button active" data-target="main-content">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</button>
      <button class="nav-button" data-target="groups-content">–ì—Ä—É–ø–∏</button>
    </div>

    <!-- Materials -->
    <div id="main-content" class="content-section active">
      {{#if isOwner}}
        <button class="add-btn" onclick="toggleModal('addMaterialModal')">
          + –î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª
        </button>
      {{/if}}

      {{#each materialsByType}}
      <div class="foldable-section">
        <div class="section-header" onclick="toggleSection('{{@key}}')">
          <h2>{{@key}} ({{this.length}})</h2>
          <span class="toggle-icon">‚ñº</span>
        </div>
        <div class="section-content" id="{{@key}}-content">
          {{#if this.length}}
            {{#each this}}
              <div class="material-item">
                <div class="material-info"
                     onclick="window.open('{{this.file_path}}','_blank')">
                  <img src="/img/icons/{{this.material_type}}.png"
                       class="material-icon" alt="{{this.material_type}}">
                  <span>{{this.file_name}}</span>
                </div>
                {{#if ../../isOwner}}
                <div class="material-actions">
              <button class="edit-btn"
                      onclick="showEditMaterialModal({{this.id}}, '{{this.file_name}}', '{{this.material_type}}')">
                ‚úé
              </button>
              <button class="delete-btn"
                      onclick="confirmDeleteMaterial({{this.id}}, '{{this.file_name}}')">
                üóë
              </button>
            </div>
                {{/if}}
              </div>
            {{/each}}
          {{else}}
            <div class="no-materials">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ</div>
          {{/if}}
        </div>
      </div>
      {{/each}}
    </div>

    <!-- Groups -->
    <div id="groups-content" class="content-section">
      {{#each groups}}
      <div class="foldable-section">
        <div class="group-header">
          <h2>{{this.group_name}}</h2>
          {{#if ../isOwner}}
            <button class="delete-btn"
                    onclick="confirmDeleteGroup({{this.subject_group_id}}, '{{this.group_name}}')">
              –í–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä—É–ø—É
            </button>
          {{/if}}
        </div>
        <div class="group-members">
          <div class="member-header">
            <div>–§–æ—Ç–æ</div><div>–ü–Ü–ë</div><div>–°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—å</div><div>–†–æ–ª—å</div>
          </div>
          {{#each this.members}}
          <div class="member-row"
               onclick="window.location.href='/user_profile/{{this.user_id}}'">
            <img src="{{this.user_profile_image}}" class="member-photo">
            <div>{{this.surname}} {{this.name}} {{this.parent_name}}</div>
            <div>{{this.speciality_name}}</div>
            <div>{{this.role}}</div>
          </div>
          {{/each}}
        </div>
      </div>
      {{/each}}
    </div>

    <!-- Add Material Modal -->
    <div id="addMaterialModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('addMaterialModal')">&times;</span>
        <h2>–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª</h2>
        <form id="addMaterialForm"
              action="/subject/{{subject.subject_id}}/materials"
              method="POST"
              enctype="multipart/form-data">
          <div class="form-group">
            <label>–ù–∞–∑–≤–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—É:</label>
            <input type="text" name="file_name" required>
          </div>
          <div class="form-group">
            <label>–¢–∏–ø –º–∞—Ç–µ—Ä—ñ–∞–ª—É:</label>
            <select name="material_type" required>
              <option value="lecture">–õ–µ–∫—Ü—ñ—è</option>
              <option value="task">–ó–∞–≤–¥–∞–Ω–Ω—è</option>
              <option value="additional">–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª</option>
            </select>
          </div>
          <div class="form-group">
            <label>–§–∞–π–ª:</label>
            <input type="file" name="material" required>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn"
                    onclick="closeModal('addMaterialModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button type="submit" class="submit-btn">–î–æ–¥–∞—Ç–∏</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Material Modal -->
    <div id="editMaterialModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('editMaterialModal')">&times;</span>
        <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª</h2>
        <form id="editMaterialForm"
              action=""
              method="POST">
          <input type="hidden" name="_method" value="POST">
          <div class="form-group">
            <label>–ù–∞–∑–≤–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—É:</label>
            <input type="text" id="edit-file-name" name="file_name" required>
          </div>
          <div class="form-group">
            <label>–¢–∏–ø –º–∞—Ç–µ—Ä—ñ–∞–ª—É:</label>
            <select id="edit-material-type" name="material_type" required>
              <option value="lecture">–õ–µ–∫—Ü—ñ—è</option>
              <option value="task">–ó–∞–≤–¥–∞–Ω–Ω—è</option>
              <option value="additional">–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn"
                    onclick="closeModal('editMaterialModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button type="submit" class="submit-btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Material Modal -->
    <div id="deleteMaterialModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('deleteMaterialModal')">&times;</span>
        <h2>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h2>
        <form id="deleteMaterialForm"
              action=""
              method="POST">
          <div class="form-group">
            <p>–í–∏–¥–∞–ª–∏—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª <strong id="delete-material-name"></strong>?</p>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn"
                    onclick="closeModal('deleteMaterialModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button type="submit" class="delete-confirm-btn">–í–∏–¥–∞–ª–∏—Ç–∏</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Group Modal -->
    <div id="deleteGroupModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('deleteGroupModal')">&times;</span>
        <h2>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h2>
        <form id="deleteGroupForm"
              action=""
              method="POST">
          <div class="form-group">
            <p>–í–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä—É–ø—É <strong id="delete-group-name"></strong>?</p>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn"
                    onclick="closeModal('deleteGroupModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button type="submit" class="delete-confirm-btn">–í–∏–¥–∞–ª–∏—Ç–∏</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
